<!DOCTYPE html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clash Royale Turnaj</title>
    <style>
      :root {
        --primary-color: #ff7b25;
        --light-color: #ffeadb;
        --dark-color: #d45a0c;
        --text-color: #333;
        --bg-color: #fff;
        --border-radius: 4px;
      }

      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: var(--bg-color);
        color: var(--text-color);
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 15px;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 0;
        border-bottom: 1px solid var(--light-color);
        margin-bottom: 20px;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: var(--primary-color);
      }

      .admin-login {
        position: relative;
      }

      .login-btn {
        background: none;
        border: 1px solid var(--primary-color);
        color: var(--primary-color);
        padding: 5px 15px;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: all 0.3s;
      }

      .login-btn:hover {
        background-color: var(--primary-color);
        color: white;
      }

      .login-form {
        position: absolute;
        top: 100%;
        right: 0;
        background-color: var(--bg-color);
        border: 1px solid var(--light-color);
        padding: 15px;
        border-radius: var(--border-radius);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: none;
        z-index: 100;
        width: 250px;
      }

      .login-form.active {
        display: block;
      }

      .login-form input {
        width: 100%;
        padding: 8px;
        margin-bottom: 10px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
      }

      .login-form button {
        width: 100%;
        padding: 8px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
      }

      .nav-tabs {
        display: flex;
        border-bottom: 1px solid var(--light-color);
        margin-bottom: 20px;
        overflow-x: auto;
      }

      .tab {
        padding: 10px 20px;
        cursor: pointer;
        border: 1px solid transparent;
        border-bottom: none;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        white-space: nowrap;
      }

      .tab.active {
        border-color: var(--light-color);
        border-bottom: 1px solid var(--bg-color);
        margin-bottom: -1px;
        color: var(--primary-color);
      }

      .tab:hover:not(.active) {
        background-color: var(--light-color);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }

      th,
      td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid var(--light-color);
      }

      th {
        background-color: var(--light-color);
        font-weight: 600;
      }

      tr:hover {
        background-color: rgba(255, 123, 37, 0.05);
      }

      .player-link {
        color: var(--primary-color);
        text-decoration: none;
      }

      .player-link:hover {
        text-decoration: underline;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
      }

      .btn {
        padding: 8px 15px;
        background-color: var(--primary-color);
        color: white;
        border: none;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .btn:hover {
        background-color: var(--dark-color);
      }

      .btn-secondary {
        background-color: #6c757d;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
      }

      .alert {
        padding: 10px 15px;
        border-radius: var(--border-radius);
        margin-bottom: 15px;
      }

      .alert-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }

      .alert-danger {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }

      .deck-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 10px;
      }

      .deck-card {
        width: 60px;
        height: 80px;
        background-color: var(--light-color);
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        text-align: center;
        word-break: break-word;
        padding: 5px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .deck-card img {
        max-width: 100%;
        max-height: 100%;
      }

      .rules-container {
        padding: 20px;
        background-color: var(--light-color);
        border-radius: var(--border-radius);
      }

      .rules-container h3 {
        margin-top: 15px;
        color: var(--primary-color);
      }

      .rules-container ul {
        margin-left: 20px;
      }

      .rules-container li {
        margin-bottom: 5px;
      }

      @media (max-width: 768px) {
        .nav-tabs {
          flex-wrap: wrap;
        }

        .tab {
          flex: 1 0 auto;
          text-align: center;
        }

        table {
          font-size: 14px;
        }

        th,
        td {
          padding: 8px 5px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">Clash Royale Turnaj</div>
        <div class="admin-login">
          <button class="login-btn" id="loginBtn">Admin Login</button>
          <div class="login-form" id="loginForm">
            <input type="text" id="adminUsername" placeholder="Username" />
            <input type="password" id="adminPassword" placeholder="Password" />
            <button class="btn" id="submitLogin">Přihlásit</button>
          </div>
        </div>
      </header>

      <div class="nav-tabs">
        <div class="tab active" data-tab="leaderboard">Leaderboard</div>
        <div class="tab" data-tab="matches">Zápasy</div>
        <div class="tab" data-tab="players">Hráči</div>
        <div class="tab" data-tab="rules">Pravidla</div>
      </div>

      <div class="tab-content active" id="leaderboard">
        <h2>Leaderboard</h2>
        <table id="leaderboardTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Jméno</th>
              <th>Tag</th>
              <th>Výhry</th>
              <th>Prohry</th>
              <th>Body</th>
              <th>Skóre</th>
            </tr>
          </thead>
          <tbody id="leaderboardBody">
            <!-- Leaderboard data will be loaded here -->
          </tbody>
        </table>
      </div>

      <div class="tab-content" id="matches">
        <h2>Log zápasů</h2>
        <div
          id="matchesAdminControls"
          style="display: none; margin-bottom: 20px"
        >
          <button class="btn" id="addMatchBtn">Přidat zápas</button>
        </div>
        <table id="matchesTable">
          <thead>
            <tr>
              <th>Datum</th>
              <th>Hráč 1</th>
              <th>Hráč 2</th>
              <th>Výsledek</th>
              <th>Skóre</th>
              <th>Poznámka</th>
            </tr>
          </thead>
          <tbody id="matchesBody">
            <!-- Matches data will be loaded here -->
          </tbody>
        </table>

        <div id="matchFormContainer" style="display: none; margin-top: 20px">
          <h3>Přidat nový zápas</h3>
          <form id="matchForm">
            <div class="form-group">
              <label for="matchPlayer1">Hráč 1</label>
              <select id="matchPlayer1" required>
                <!-- Players will be loaded here -->
              </select>
            </div>
            <div class="form-group">
              <label for="matchPlayer2">Hráč 2</label>
              <select id="matchPlayer2" required>
                <!-- Players will be loaded here -->
              </select>
            </div>
            <div class="form-group">
              <label for="matchWinner">Vítěz</label>
              <select id="matchWinner" required>
                <option value="">Vyberte vítěze</option>
                <option value="1">Hráč 1</option>
                <option value="2">Hráč 2</option>
              </select>
            </div>
            <div class="form-group">
              <label for="matchScore">Skóre (např. 3-1)</label>
              <input type="text" id="matchScore" placeholder="3-1" required />
            </div>
            <div class="form-group">
              <label for="matchNote">Poznámka</label>
              <textarea id="matchNote" rows="3"></textarea>
            </div>
            <button type="submit" class="btn">Uložit</button>
            <button type="button" class="btn btn-secondary" id="cancelMatchBtn">
              Zrušit
            </button>
          </form>
        </div>
      </div>

      <div class="tab-content" id="players">
        <h2>Správa hráčů</h2>
        <div
          id="playersAdminControls"
          style="display: none; margin-bottom: 20px"
        >
          <button class="btn" id="addPlayerBtn">Přidat hráče</button>
        </div>
        <table id="playersTable">
          <thead>
            <tr>
              <th>Jméno</th>
              <th>Tag</th>
              <th>Výhry</th>
              <th>Prohry</th>
              <th>Body</th>
              <th>Skóre</th>
              <th>Akce</th>
            </tr>
          </thead>
          <tbody id="playersBody">
            <!-- Players data will be loaded here -->
          </tbody>
        </table>

        <div id="playerFormContainer" style="display: none; margin-top: 20px">
          <h3 id="playerFormTitle">Přidat nového hráče</h3>
          <form id="playerForm">
            <input type="hidden" id="playerId" />
            <div class="form-group">
              <label for="playerName">Jméno</label>
              <input type="text" id="playerName" required />
            </div>
            <div class="form-group">
              <label for="playerTag">Tag hráče (např. #ABC123)</label>
              <input type="text" id="playerTag" required />
            </div>
            <div class="form-group">
              <label for="playerWins">Výhry</label>
              <input type="number" id="playerWins" value="0" min="0" />
            </div>
            <div class="form-group">
              <label for="playerLosses">Prohry</label>
              <input type="number" id="playerLosses" value="0" min="0" />
            </div>
            <div class="form-group">
              <label for="playerPoints">Body</label>
              <input type="number" id="playerPoints" value="0" min="0" />
            </div>
            <div class="form-group">
              <label for="playerScore">Skóre</label>
              <input type="text" id="playerScore" value="0-0" />
            </div>
            <div id="deckInfo" style="display: none; margin-bottom: 15px">
              <h4>Deck hráče</h4>
              <div class="deck-container" id="deckContainer">
                <!-- Deck cards will be loaded here -->
              </div>
            </div>
            <button type="submit" class="btn">Uložit</button>
            <button
              type="button"
              class="btn btn-secondary"
              id="cancelPlayerBtn"
            >
              Zrušit
            </button>
          </form>
        </div>
      </div>

      <div class="tab-content" id="rules">
        <h2>Pravidla turnaje</h2>
        <div class="rules-container">
          <h3>📜 PRAVIDLA</h3>
          <ul>
            <li>
              Je nutné pro start v lize být v klanu 4 veterani nebo aspoň mít
              všechny hráče ve friendech
            </li>
            <li>Přidávání nových hráčů bez povolení founderů je zakázáno</li>
            <li>
              Během hracího dne je povinnost odehrát všechny zápasy ve své
              divizi, jinak trestáno odečítáním 3 bodů, v případě delší
              neaktivity ban dle dohody founderů
            </li>
            <li>V případě nejasností kontaktovat foundery</li>
          </ul>

          <h3>📈 SYSTÉM</h3>
          <ul>
            <li>
              Každá divize 1 až 3 má 4 hráče, kteří mezi sebou hrají zápasy
              (každý s každým jeden zápas). Na módu se dohodnou hráči. Na konci
              ligy je playoff:
            </li>
            <li>hráč x 4. hráč</li>
            <li>hráč x 3. hráč</li>
            <li>Semifinále a boj o TOP 3.</li>
            <li>Hráč na 4. místě sestupuje, vítěz postupuje.</li>
            <li>Výhra v základní hrací době = 3 body</li>
            <li>Výhra v overtime = 2 body, poražený 1 bod</li>
            <li>Skóre zničených towerek se počítá při shodě bodů</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let isAdmin = false;
      let players = [];
      let matches = [];
      let editingPlayerId = null;
      let editingMatchId = null;

      // DOM elements
      const loginBtn = document.getElementById("loginBtn");
      const loginForm = document.getElementById("loginForm");
      const submitLogin = document.getElementById("submitLogin");
      const adminUsername = document.getElementById("adminUsername");
      const adminPassword = document.getElementById("adminPassword");

      const tabs = document.querySelectorAll(".tab");
      const tabContents = document.querySelectorAll(".tab-content");

      const leaderboardBody = document.getElementById("leaderboardBody");
      const matchesBody = document.getElementById("matchesBody");
      const playersBody = document.getElementById("playersBody");

      const playersAdminControls = document.getElementById(
        "playersAdminControls"
      );
      const matchesAdminControls = document.getElementById(
        "matchesAdminControls"
      );
      const addPlayerBtn = document.getElementById("addPlayerBtn");
      const addMatchBtn = document.getElementById("addMatchBtn");

      const playerFormContainer = document.getElementById(
        "playerFormContainer"
      );
      const playerForm = document.getElementById("playerForm");
      const playerFormTitle = document.getElementById("playerFormTitle");
      const playerIdInput = document.getElementById("playerId");
      const playerNameInput = document.getElementById("playerName");
      const playerTagInput = document.getElementById("playerTag");
      const playerWinsInput = document.getElementById("playerWins");
      const playerLossesInput = document.getElementById("playerLosses");
      const playerPointsInput = document.getElementById("playerPoints");
      const playerScoreInput = document.getElementById("playerScore");
      const cancelPlayerBtn = document.getElementById("cancelPlayerBtn");
      const deckInfo = document.getElementById("deckInfo");
      const deckContainer = document.getElementById("deckContainer");

      const matchFormContainer = document.getElementById("matchFormContainer");
      const matchForm = document.getElementById("matchForm");
      const matchPlayer1Select = document.getElementById("matchPlayer1");
      const matchPlayer2Select = document.getElementById("matchPlayer2");
      const matchWinnerSelect = document.getElementById("matchWinner");
      const matchScoreInput = document.getElementById("matchScore");
      const matchNoteInput = document.getElementById("matchNote");
      const cancelMatchBtn = document.getElementById("cancelMatchBtn");

      // Event listeners
      document.addEventListener("DOMContentLoaded", () => {
        loadData();
        setupEventListeners();
      });

      function setupEventListeners() {
        // Tab switching
        tabs.forEach((tab) => {
          tab.addEventListener("click", () => {
            const tabId = tab.getAttribute("data-tab");
            switchTab(tabId);
          });
        });

        // Admin login
        loginBtn.addEventListener("click", () => {
          loginForm.classList.toggle("active");
        });

        submitLogin.addEventListener("click", () => {
          const username = adminUsername.value;
          const password = adminPassword.value;

          // Simple admin authentication (in a real app, this would be more secure)
          if (username === "admin" && password === "admin123") {
            isAdmin = true;
            loginForm.classList.remove("active");
            loginBtn.textContent = "Admin";
            showAdminControls();
            showAlert("Přihlášení úspěšné", "success");
          } else {
            showAlert("Neplatné přihlašovací údaje", "danger");
          }
        });

        // Player management
        addPlayerBtn.addEventListener("click", () => {
          editingPlayerId = null;
          playerFormTitle.textContent = "Přidat nového hráče";
          playerForm.reset();
          deckInfo.style.display = "none";
          playerFormContainer.style.display = "block";
        });

        cancelPlayerBtn.addEventListener("click", () => {
          playerFormContainer.style.display = "none";
        });

        playerForm.addEventListener("submit", (e) => {
          e.preventDefault();
          savePlayer();
        });

        // Match management
        addMatchBtn.addEventListener("click", () => {
          editingMatchId = null;
          populatePlayerSelects();
          matchForm.reset();
          matchFormContainer.style.display = "block";
        });

        cancelMatchBtn.addEventListener("click", () => {
          matchFormContainer.style.display = "none";
        });

        matchForm.addEventListener("submit", (e) => {
          e.preventDefault();
          saveMatch();
        });

        // Update match winner options when players change
        matchPlayer1Select.addEventListener("change", updateMatchWinnerOptions);
        matchPlayer2Select.addEventListener("change", updateMatchWinnerOptions);
      }

      function switchTab(tabId) {
        // Update active tab
        tabs.forEach((tab) => {
          if (tab.getAttribute("data-tab") === tabId) {
            tab.classList.add("active");
          } else {
            tab.classList.remove("active");
          }
        });

        // Update active tab content
        tabContents.forEach((content) => {
          if (content.id === tabId) {
            content.classList.add("active");
          } else {
            content.classList.remove("active");
          }
        });

        // Refresh data if needed
        if (tabId === "leaderboard") {
          renderLeaderboard();
        } else if (tabId === "matches") {
          renderMatches();
        } else if (tabId === "players") {
          renderPlayers();
        }
      }

      function showAdminControls() {
        if (isAdmin) {
          playersAdminControls.style.display = "block";
          matchesAdminControls.style.display = "block";

          // Add edit buttons to player rows
          const playerRows = document.querySelectorAll("#playersBody tr");
          playerRows.forEach((row) => {
            const playerId = row.getAttribute("data-id");
            const editBtn = document.createElement("button");
            editBtn.className = "btn btn-secondary";
            editBtn.textContent = "Upravit";
            editBtn.style.marginRight = "5px";
            editBtn.addEventListener("click", () => editPlayer(playerId));

            const deleteBtn = document.createElement("button");
            deleteBtn.className = "btn btn-secondary";
            deleteBtn.textContent = "Smazat";
            deleteBtn.addEventListener("click", () => deletePlayer(playerId));

            const actionsCell = row.querySelector(".actions");
            if (actionsCell) {
              actionsCell.innerHTML = "";
              actionsCell.appendChild(editBtn);
              actionsCell.appendChild(deleteBtn);
            }
          });
        }
      }

      function showAlert(message, type) {
        const alert = document.createElement("div");
        alert.className = `alert alert-${type}`;
        alert.textContent = message;

        document.querySelector(".container").prepend(alert);

        setTimeout(() => {
          alert.remove();
        }, 3000);
      }

      // Data management
      function loadData() {
        // Try to load from data.json first
        fetch("data.json")
          .then((response) => {
            if (!response.ok) throw new Error("Network response was not ok");
            return response.json();
          })
          .then((data) => {
            players = data.players || [];
            matches = data.matches || [];
            renderAll();
          })
          .catch((error) => {
            console.log("Error loading data.json, trying localStorage:", error);
            // Fallback to localStorage
            const savedData = localStorage.getItem("clashRoyaleTournamentData");
            if (savedData) {
              const data = JSON.parse(savedData);
              players = data.players || [];
              matches = data.matches || [];
            } else {
              // Initialize with empty arrays if no data found
              players = [];
              matches = [];
            }
            renderAll();
          });
      }

      function saveData() {
        const data = {
          players,
          matches,
        };

        // Save to localStorage as fallback
        localStorage.setItem("clashRoyaleTournamentData", JSON.stringify(data));

        // In a real app, you would send this to a server to save to data.json
        // For this demo, we'll just log it
        console.log("Data to be saved:", data);
      }

      function renderAll() {
        renderLeaderboard();
        renderMatches();
        renderPlayers();
      }

      function renderLeaderboard() {
        // Sort players by points (descending)
        const sortedPlayers = [...players].sort((a, b) => b.points - a.points);

        leaderboardBody.innerHTML = "";

        sortedPlayers.forEach((player, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><a href="https://royaleapi.com/player/${player.tag.replace(
                      "#",
                      ""
                    )}" class="player-link" target="_blank">${
            player.name
          }</a></td>
                    <td>${player.tag}</td>
                    <td>${player.wins}</td>
                    <td>${player.losses}</td>
                    <td>${player.points}</td>
                    <td>${player.score}</td>
                `;
          leaderboardBody.appendChild(row);
        });
      }

      function renderMatches() {
        matchesBody.innerHTML = "";

        matches.forEach((match) => {
          const player1 = players.find((p) => p.id === match.player1Id);
          const player2 = players.find((p) => p.id === match.player2Id);

          if (!player1 || !player2) return;

          const winner = match.winner === "1" ? player1.name : player2.name;

          const row = document.createElement("tr");
          row.innerHTML = `
                    <td>${new Date(match.date).toLocaleDateString()}</td>
                    <td>${player1.name}</td>
                    <td>${player2.name}</td>
                    <td>${winner}</td>
                    <td>${match.score}</td>
                    <td>${match.note || ""}</td>
                `;
          matchesBody.appendChild(row);
        });
      }

      function renderPlayers() {
        playersBody.innerHTML = "";

        players.forEach((player) => {
          const row = document.createElement("tr");
          row.setAttribute("data-id", player.id);
          row.innerHTML = `
                    <td>${player.name}</td>
                    <td>${player.tag}</td>
                    <td>${player.wins}</td>
                    <td>${player.losses}</td>
                    <td>${player.points}</td>
                    <td>${player.score}</td>
                    <td class="actions"></td>
                `;
          playersBody.appendChild(row);
        });

        if (isAdmin) {
          showAdminControls();
        }
      }

      function populatePlayerSelects() {
        matchPlayer1Select.innerHTML = "";
        matchPlayer2Select.innerHTML = "";

        players.forEach((player) => {
          const option1 = document.createElement("option");
          option1.value = player.id;
          option1.textContent = player.name;
          matchPlayer1Select.appendChild(option1);

          const option2 = document.createElement("option");
          option2.value = player.id;
          option2.textContent = player.name;
          matchPlayer2Select.appendChild(option2);
        });
      }

      function updateMatchWinnerOptions() {
        const player1Id = matchPlayer1Select.value;
        const player2Id = matchPlayer2Select.value;

        if (!player1Id || !player2Id) return;

        const player1 = players.find((p) => p.id === player1Id);
        const player2 = players.find((p) => p.id === player2Id);

        matchWinnerSelect.innerHTML = `
                <option value="">Vyberte vítěze</option>
                <option value="1">${player1.name}</option>
                <option value="2">${player2.name}</option>
            `;
      }

      // Player CRUD operations
      function savePlayer() {
        const playerData = {
          name: playerNameInput.value,
          tag: playerTagInput.value,
          wins: parseInt(playerWinsInput.value) || 0,
          losses: parseInt(playerLossesInput.value) || 0,
          points: parseInt(playerPointsInput.value) || 0,
          score: playerScoreInput.value || "0-0",
        };

        if (editingPlayerId) {
          // Update existing player
          const index = players.findIndex((p) => p.id === editingPlayerId);
          if (index !== -1) {
            players[index] = { ...players[index], ...playerData };
            showAlert("Hráč byl úspěšně aktualizován", "success");
          }
        } else {
          // Add new player
          const newPlayer = {
            id: Date.now().toString(),
            ...playerData,
          };
          players.push(newPlayer);
          showAlert("Hráč byl úspěšně přidán", "success");

          // Try to fetch deck for new player
          fetchDeck(newPlayer.tag);
        }

        saveData();
        renderAll();
        playerFormContainer.style.display = "none";
      }

      function editPlayer(playerId) {
        const player = players.find((p) => p.id === playerId);
        if (!player) return;

        editingPlayerId = playerId;
        playerFormTitle.textContent = "Upravit hráče";
        playerIdInput.value = playerId;
        playerNameInput.value = player.name;
        playerTagInput.value = player.tag;
        playerWinsInput.value = player.wins;
        playerLossesInput.value = player.losses;
        playerPointsInput.value = player.points;
        playerScoreInput.value = player.score;

        // Show deck if available
        if (player.deck) {
          deckInfo.style.display = "block";
          renderDeck(player.deck);
        } else {
          deckInfo.style.display = "none";
          // Try to fetch deck
          fetchDeck(player.tag);
        }

        playerFormContainer.style.display = "block";
      }

      function deletePlayer(playerId) {
        if (confirm("Opravdu chcete smazat tohoto hráče?")) {
          players = players.filter((p) => p.id !== playerId);
          // Also remove any matches involving this player
          matches = matches.filter(
            (m) => m.player1Id !== playerId && m.player2Id !== playerId
          );

          saveData();
          renderAll();
          showAlert("Hráč byl úspěšně smazán", "success");
        }
      }

      function fetchDeck(playerTag) {
        // In a real app, you would call the Clash Royale API here
        // This is a mock implementation for demonstration
        console.log(`Fetching deck for player ${playerTag}`);

        // Simulate API call delay
        setTimeout(() => {
          // Mock deck data
          const mockDecks = [
            [
              "Golem",
              "Night Witch",
              "Baby Dragon",
              "Tornado",
              "Poison",
              "Mega Minion",
              "Lumberjack",
              "Dark Prince",
            ],
            [
              "P.E.K.K.A",
              "Battle Ram",
              "Royal Ghost",
              "Poison",
              "Electro Wizard",
              "Zap",
              "Bandit",
              "Dark Prince",
            ],
            [
              "Hog Rider",
              "Musketeer",
              "Valkyrie",
              "Fireball",
              "Cannon",
              "Ice Spirit",
              "Skeletons",
              "Log",
            ],
            [
              "X-Bow",
              "Tesla",
              "Archers",
              "Knight",
              "Ice Spirit",
              "Fireball",
              "Log",
              "Skeletons",
            ],
          ];

          const randomDeck =
            mockDecks[Math.floor(Math.random() * mockDecks.length)];

          // Update player with deck
          const playerIndex = players.findIndex((p) => p.tag === playerTag);
          if (playerIndex !== -1) {
            players[playerIndex].deck = randomDeck;

            // If we're currently editing this player, update the UI
            if (editingPlayerId === players[playerIndex].id) {
              deckInfo.style.display = "block";
              renderDeck(randomDeck);
            }

            saveData();
          }
        }, 1000);
      }

      function renderDeck(deckCards) {
        deckContainer.innerHTML = "";

        deckCards.forEach((cardName) => {
          const cardElement = document.createElement("div");
          cardElement.className = "deck-card";
          cardElement.textContent = cardName;
          deckContainer.appendChild(cardElement);
        });
      }

      // Match CRUD operations
      function saveMatch() {
        const player1Id = matchPlayer1Select.value;
        const player2Id = matchPlayer2Select.value;

        if (player1Id === player2Id) {
          showAlert("Hráč 1 a hráč 2 nemohou být stejní", "danger");
          return;
        }

        const matchData = {
          player1Id,
          player2Id,
          winner: matchWinnerSelect.value,
          score: matchScoreInput.value,
          note: matchNoteInput.value,
          date: new Date().toISOString(),
        };

        if (editingMatchId) {
          // Update existing match
          const index = matches.findIndex((m) => m.id === editingMatchId);
          if (index !== -1) {
            matches[index] = { ...matches[index], ...matchData };
            showAlert("Zápas byl úspěšně aktualizován", "success");
          }
        } else {
          // Add new match
          const newMatch = {
            id: Date.now().toString(),
            ...matchData,
          };
          matches.push(newMatch);
          showAlert("Zápas byl úspěšně přidán", "success");

          // Update player stats based on match result
          updatePlayerStats(newMatch);
        }

        saveData();
        renderAll();
        matchFormContainer.style.display = "none";
      }

      function updatePlayerStats(match) {
        const player1 = players.find((p) => p.id === match.player1Id);
        const player2 = players.find((p) => p.id === match.player2Id);

        if (!player1 || !player2) return;

        const [score1, score2] = match.score.split("-").map(Number);

        if (match.winner === "1") {
          // Player 1 won
          player1.wins += 1;
          player2.losses += 1;
          player1.points += 3;
        } else {
          // Player 2 won
          player2.wins += 1;
          player1.losses += 1;
          player2.points += 3;
        }

        // Update scores
        player1.score = updateScore(player1.score, score1, score2);
        player2.score = updateScore(player2.score, score2, score1);
      }

      function updateScore(currentScore, newScoreFor, newScoreAgainst) {
        const [currentFor, currentAgainst] = currentScore
          .split("-")
          .map(Number);
        const totalFor = (currentFor || 0) + newScoreFor;
        const totalAgainst = (currentAgainst || 0) + newScoreAgainst;
        return `${totalFor}-${totalAgainst}`;
      }
    </script>
  </body>
</html>
